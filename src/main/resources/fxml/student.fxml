<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.Pagination?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.AnchorPane?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.RowConstraints?>
<?import javafx.scene.layout.VBox?>

<AnchorPane prefHeight="700.0" prefWidth="900.0" xmlns="http://javafx.com/javafx/23.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.studentmanagement.controller.StudentController">
   <children>
      <VBox spacing="8" AnchorPane.bottomAnchor="0.0" AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0" AnchorPane.topAnchor="0.0">
         <!-- Student ID input section with student name on same line -->
         <HBox alignment="CENTER_LEFT" spacing="15.0">
            <Label text="ID étudiant :" />
            <TextField fx:id="studentIdField" prefWidth="80" />
            <Button fx:id="okButton" onAction="#handleLoadStudent" text="OK" />
            <Label fx:id="studentNameLabel" text="Nom de l'étudiant : " />
            <padding>
               <Insets bottom="5.0" left="10.0" right="10.0" top="5.0" />
            </padding>
         </HBox>
         <!-- Student class info -->
         <HBox alignment="CENTER_LEFT" spacing="10.0">
            <Label fx:id="studentClassLabel" text="Classe : " />
            <padding>
               <Insets left="10.0" right="10.0" top="2.0" />
            </padding>
         </HBox>
         <!-- Grade input section -->
         <GridPane hgap="5" vgap="5">
            <columnConstraints>
               <ColumnConstraints hgrow="SOMETIMES" minWidth="200" />
               <ColumnConstraints hgrow="NEVER" minWidth="60" />
               <ColumnConstraints hgrow="NEVER" minWidth="60" />
               <ColumnConstraints hgrow="SOMETIMES" />
            </columnConstraints>
            <rowConstraints>
               <RowConstraints vgrow="SOMETIMES" />
               <RowConstraints vgrow="SOMETIMES" />
            </rowConstraints>
            <!-- Labels row -->
            <Label text="Matières" GridPane.columnIndex="0" GridPane.rowIndex="0" />
            <Label text="Note" GridPane.columnIndex="1" GridPane.rowIndex="0" />
            <Label text="Coeff" GridPane.columnIndex="2" GridPane.rowIndex="0" />            
            <!-- Input fields row -->
            <ComboBox fx:id="subjectComboBox" prefWidth="200" GridPane.columnIndex="0" GridPane.rowIndex="1" />
               <TextField fx:id="gradeField" prefWidth="50" GridPane.columnIndex="1" GridPane.rowIndex="1" />
               <TextField fx:id="coefficientField" prefWidth="50" GridPane.columnIndex="2" GridPane.rowIndex="1" />
            <Button fx:id="addGradeButton" onAction="#handleAddGrade" text="J'ajoute une note" GridPane.columnIndex="3" GridPane.rowIndex="1" />           
            <padding>
               <Insets bottom="2.0" left="10.0" right="10.0" top="2.0" />
            </padding>
         </GridPane>
         <!-- Comment section -->
         <HBox alignment="CENTER_LEFT" spacing="10.0">
            <VBox spacing="5" HBox.hgrow="ALWAYS">
               <Label text="Commentaire" />
               <HBox alignment="CENTER_LEFT" spacing="10">
                  <TextArea fx:id="commentArea" prefHeight="60" prefWidth="450" />
                  <Button fx:id="addCommentButton" onAction="#handleAddComment" text="J'ajoute un commentaire" />
               </HBox>
            </VBox>
            <padding>
               <Insets left="10.0" right="10.0" />
            </padding>
         </HBox>
         <!-- Search bar -->
         <HBox alignment="CENTER_LEFT" spacing="10.0">
            <TextField fx:id="searchField" promptText="Rechercher ..." HBox.hgrow="ALWAYS" />
            <Button fx:id="sortButton" onAction="#handleSort" text="Je trie" />
            <padding>
               <Insets left="10.0" right="10.0" />
            </padding>
         </HBox>
         <!-- Grades table -->
         <VBox VBox.vgrow="ALWAYS">
            <TableView fx:id="gradesTable" prefHeight="300" VBox.vgrow="ALWAYS">
               <columns>
                  <TableColumn fx:id="subjectColumn" prefWidth="120" text="Matières" />
                  <TableColumn fx:id="gradesColumn" prefWidth="100" text="Notes" />
                  <TableColumn fx:id="minAverageColumn" prefWidth="120" text="Moyenne minimum de la classe" />
                  <TableColumn fx:id="maxAverageColumn" prefWidth="120" text="Moyenne maximum de la classe" />
                  <TableColumn fx:id="studentAverageColumn" prefWidth="120" text="Moyenne de l'étudiant" />
                  <TableColumn fx:id="commentsColumn" prefWidth="200" text="Commentaires" />
               </columns>
            </TableView>
            <!-- Pagination and export -->
            <HBox alignment="CENTER" spacing="10">
               <Region HBox.hgrow="ALWAYS" />
               <Pagination fx:id="pagination" maxPageIndicatorCount="1000" pageCount="1" />
               <Region HBox.hgrow="ALWAYS" />
               <Button fx:id="exportButton" onAction="#handleExport" text="J'exporte" />
               <padding>
                  <Insets bottom="5.0" top="5.0" />
               </padding>
            </HBox>
         </VBox>
      </VBox>
   </children>
</AnchorPane>